**Phantom reads** (фантомные чтения) — это аномалия, возникающая при выполнении транзакций в многопользовательских базах данных, когда одна транзакция повторно выполняет запрос и получает различное количество строк в результате из-за того, что другая транзакция добавила или удалила строки, соответствующие условиям запроса. Фантомные чтения происходят на более высоком уровне, чем неповторяемые чтения, так как они касаются не изменения конкретных данных, а изменения самих наборов данных.

### Пример:

Представим таблицу `employees`, содержащую записи о сотрудниках компании:

1. **Транзакция A** выполняет запрос для получения списка всех сотрудников, работающих в отделе `Sales`:
   ```sql
   select * from employees where department = 'Sales';
   ```
   В результате она получает 5 строк.

2. **Транзакция B** добавляет нового сотрудника в отдел `Sales` и фиксирует изменения (`commit`):
   ```sql
   insert into employees (name, department) values ('John Doe', 'Sales');
   ```

3. **Транзакция A** повторяет тот же запрос:
   ```sql
   select * from employees where department = 'Sales';
   ```
   На этот раз она получает 6 строк вместо 5.

В этом случае, новая строка, добавленная транзакцией B, действует как "фантом", который не существовал при первом запросе транзакции A, но появился при повторном запросе.

### Причины возникновения:

Фантомные чтения происходят из-за того, что между выполнением двух одинаковых запросов в рамках одной транзакции другая транзакция вносит изменения в набор данных, добавляя или удаляя строки, которые удовлетворяют условиям запроса первой транзакции. Эта аномалия возникает на более сложных уровнях операций с базой данных, когда изменения затрагивают целые наборы строк, а не отдельные поля.

### Способы предотвращения:

1. **Уровни изоляции транзакций**: Использование более строгих уровней изоляции транзакций может предотвратить фантомные чтения:
   - **Repeatable Read**: Этот уровень изоляции предотвращает неповторяемые чтения, но не защищает от фантомных чтений.
   - **Serializable**: Самый строгий уровень изоляции, который предотвращает все возможные аномалии чтения, включая фантомные чтения. На этом уровне транзакции выполняются так, как если бы они были последовательными, что исключает любые изменения набора строк другим пользователем до завершения текущей транзакции.

2. **Блокировки на уровне диапазонов**: Для предотвращения фантомных чтений можно использовать блокировки на уровне диапазонов (`range-locking`). Этот метод блокирует не только отдельные строки, но и диапазоны данных, соответствующие условиям запроса, предотвращая добавление или удаление строк, которые могут быть возвращены запросом.

3. **Многоверсионность (MVCC)**: Как и в случае с неповторяемыми чтениями, многоверсионное управление конкурентным доступом (MVCC) может помочь предотвратить фантомные чтения. MVCC предоставляет каждой транзакции моментальный снимок данных на момент её начала, исключая возможность появления новых строк, которые могут изменить результат выборки.

### Отличие от других аномалий чтения:

- **Грязное чтение (Dirty Read)**: Чтение данных, измененных, но не зафиксированных другой транзакцией.
- **Неповторяемое чтение (Non-repeatable Read)**: Чтение данных, которые изменены другой транзакцией между двумя последовательными чтениями одной и той же строки.
- **Фантомное чтение (Phantom Read)**: В отличие от неповторяемого чтения, фантомное чтение затрагивает наборы строк, соответствующие условиям запроса, и возникает из-за добавления или удаления строк.

### Итог:

Фантомные чтения могут привести к некорректным результатам при выполнении транзакций, особенно в случаях, когда необходимо учитывать точное количество строк, соответствующих запросу. Для предотвращения этой аномалии используются более строгие уровни изоляции транзакций и специальные механизмы блокировки данных.